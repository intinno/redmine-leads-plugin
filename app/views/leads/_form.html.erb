<%= error_messages_for 'lead' %>

<% content_for :header_tags do %>
  <%= stylesheet_link_tag 'multiple_select', :plugin => 'leads' %>
  <%= javascript_include_tag 'organization', :plugin => 'leads' %>
  <%= javascript_include_tag 'edit_on_click', :plugin => 'highrise-edit-on-click' %>
  <%= javascript_tag "
    function appendOrgId(element, value) {
      $('lead_org_id').value = value.down('.org-id').innerHTML;
    }
    function showNewOrg(){
     $('lead_org_id').disable();
     $('existing-org').hide();
     $('new-org').show();
     $$('.new-org input').each(function(elem){elem.enable();});
    }
    function showExistingOrg(){
      $('lead_org_id').enable();
      $('existing-org').show();
      $('new-org').hide();
      $$('.new-org input').each(function(elem){elem.disable();});
    }
  " %>
<% end %>

<div class="box"> 
  <%= render :partial => 'org_details', :locals => {:f => f} %>
  <fieldset>
    <legend> Lead Details </legend>

    <p><%= f.select 'state', Lead::STATES, :required => true -%></p>

    <p><%= f.eoc_select 'assigned_to_id', @lead.assignable_members.collect{|p| [p.name, p.id]}, {:include_blank => true}, {} -%></p>


    <p><%= label_tag "Related Product(s)" %><span class="required">*</span></p>
    <%= collection_multiple_select 'lead', 'project_ids', Project.products, :id, :name, 
      {:selected_items => @lead.project_ids, :outer_class => "multiple-select"} -%>
      
      <p><label><%= "Watchers" %></label>
      <% @lead.watching_members.each do |user| %>
        <label class="floating">
          <%= check_box_tag 'lead[watcher_user_ids][]', user.id, @lead.watcher_user_ids.include?(user.id) %> <%= h user%>
        </label>
      <% end %>
    </p>
  </fieldset>
</div>
